╔═══════════════════════════════════════════════════════════════════════════╗
║                    ESP32-C6 HTTP AUDIO PLAYER                             ║
║                         CONNECTION DIAGRAM                                ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌────────────────────────────────────────────────────────────────────────────┐
│                         XIAO ESP32-C6                                      │
│                                                                            │
│  [5V]  [GND] [3V3]                       [D7/17] [D6/16]  [D10/18] [D9/20] │
│   │     │     │                            │       │          │        │   │
│   │     │     │                            │       │          │        │   │
│   │     │     │          [D2/2] [D3/21] [D4/22]    │          │        │   │
│   │     │     │            │       │       │       │          │        │   │
└───┼─────┼─────┼────────────┼───────┼───────┼───────┼──────────┼────────┼───┘
    │     │     │            │       │       │       │          │        │
    │     │     │            │       │       │       │          │        │
    │     │     │          LED1    LED2    LED3                 │      BUTTON
    │     │     │         (WiFi)  (HTTP)  (Audio)               │        │
    │     │     │            │       │       │                  │       GND
    │     │     │          GREEN   BLUE    RED                  │
    │     │     │            │       │       │                  │
    │     │     │          220Ω   220Ω   220Ω                   │
    │     │     │            │       │       │                  │
    │     │     │           GND    GND    GND                   │
    │     │     │
    │     │     │     ┌───────────────────────────────────────┐
    │     │     │     │      DFPlayer Mini MP3 Module         │
    │     │     │     ├───────────────────────────────────────┤
    ├─────┼─────┼─────┤ VCC (5V)                              │
    │     ├─────┼─────┤ GND                                   │
    │     │     │     │                                       │
    │     │     │     │ RX  ←───────────────────── GPIO16     │
    │     │     │     │ TX  ─────────────────────→ GPIO17     │
    │     │     │     │                                       │
    │     │     │     │ SPK1 ──┐                              │
    │     │     │     │        │  ┌─────────────┐             │
    │     │     │     │ SPK2 ──┼──┤   SPEAKER   │             │
    │     │     │     │        └──┤   (3W 8Ω)   │             │
    │     │     │     │           └─────────────┘             │
    │     │     │     │                                       │
    │     │     │     │  [MicroSD Card Slot]                  │
    │     │     │     │   └─ 001.mp3                          │
    │     │     │     │      002.mp3                          │
    │     │     │     │      003.mp3                          │
    │     │     │     │      ...                              │
    │     │     │     └───────────────────────────────────────┘
    │     │     │
    └─────┴─────┴─── USB-C (Programming and Power)


╔═════════════════════════════════════════════════════════════════════════╗
║                          PIN TABLE                                      ║
╠═══════════════╦═══════════════╦═════════════════════════════════════════╣
║ ESP32-C6 Pin  ║ Connection    ║ Description                             ║
╠═══════════════╬═══════════════╬═════════════════════════════════════════╣
║ GPIO 20       ║ Button        ║ INPUT_PULLUP, pressed to GND            ║
║ GPIO 2        ║ LED 1 (Green) ║ WiFi status (Connected=ON)              ║
║ GPIO 21       ║ LED 2 (Blue)  ║ HTTP operation (Blinks)                 ║
║ GPIO 16       ║ LED 3 (Red)   ║ Audio playing (ON=Playing)              ║
║ GPIO 22       ║ DFPlayer TX   ║ UART RX (ESP to DFPlayer)               ║
║ GPIO 23       ║ DFPlayer RX   ║ UART TX (DFPlayer to ESP)               ║
║ 5V            ║ DFPlayer VCC  ║ Power supply (min 500mA recommended)    ║
║ GND           ║ Common GND    ║ All GNDs must be connected together     ║
╚═══════════════╩═══════════════╩═════════════════════════════════════════╝


╔═══════════════════════════════════════════════════════════════════════════╗
║                        LED STATUS INDICATORS                              ║
╠═════════════╦═══════════════╦═════════════════════════════════════════════╣
║ LED         ║ State         ║ Meaning                                     ║
╠═════════════╬═══════════════╬═════════════════════════════════════════════╣
║ LED1 (Green)║ Solid ON      ║ WiFi connected                              ║
║             ║ Blinking      ║ WiFi connecting                             ║
║             ║ OFF           ║ WiFi not connected                          ║
╠═════════════╬═══════════════╬═════════════════════════════════════════════╣
║ LED2 (Blue) ║ ON            ║ HTTP request being sent                     ║
║             ║ Blinks 5x     ║ HTTP error                                  ║
║             ║ Blinks 3x     ║ URL not found error                         ║
╠═════════════╬═══════════════╬═════════════════════════════════════════════╣
║ LED3 (Red)  ║ ON            ║ Audio file playing                          ║
║             ║ Fast blink    ║ DFPlayer error (continuous)                 ║
╠═════════════╬═══════════════╬═════════════════════════════════════════════╣
║ All LEDs    ║ Sequential 2x ║ Startup test (test command)                 ║
╚═════════════╩═══════════════╩═════════════════════════════════════════════╝


╔═══════════════════════════════════════════════════════════════════════════╗
║                          BREADBOARD LAYOUT                                ║
╚═══════════════════════════════════════════════════════════════════════════╝

         +5V Rail
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
              ↑                    ↑
         ESP32-C6 5V          DFPlayer VCC
         
         
    ESP32-C6                    DFPlayer Mini
    ┌────────┐                  ┌──────────┐
    │        │                  │          │
    │   5V ──┼──────────────────┼→ VCC     │
    │  GND ──┼──────────────────┼→ GND     │
    │        │                  │          │
    │ GPIO22─┼──────────────────┼→ RX      │
    │ GPIO23─┼──────────────────┼→ TX      │
    │        │                  │          │
    │        │                  │ SPK1/2 ──┼─→ [Speaker]
    │        │                  │          │
    │        │                  │ [SD Card]│
    │        │                  └──────────┘
    │        │
    │ GPIO20─┼──→ [Button] ──→ GND
    │        │
    │ GPIO2──┼──→ [220Ω] ──→ [LED1] ──→ GND
    │ GPIO21─┼──→ [220Ω] ──→ [LED2] ──→ GND
    │ GPIO16─┼──→ [220Ω] ──→ [LED3] ──→ GND
    │        │
    └────────┘

         GND Rail
         ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
              ↓         ↓      ↓      ↓         ↓
         ESP32 GND   LED1   LED2   LED3   DFPlayer GND


╔═════════════════════════════════════════════════════════════════════════╗
║                   ORIGINAL TOY WIRING (COLOR CODES)                     ║
╠═══════════════╦═══════════════╦═════════════════════════════════════════╣
║ Wire Color    ║ Connection    ║ Description                             ║
╠═══════════════╬═══════════════╬═════════════════════════════════════════╣
║ YELLOW_1      ║ GPIO 20       ║ Button input (has diode, 50% correct)   ║
║ YELLOW_2      ║ GND           ║ Button ground (has diode)               ║
║               ║               ║ ⚠️ If button doesn't work, swap yellows ║
║ RED           ║ Sword LED     ║ LED indicator for sword                 ║
║ PURPLE        ║ Armor LED     ║ LED indicator for armor                 ║
║ GREEN         ║ GND           ║ Common ground                           ║
║ BLACK         ║ GND           ║ Common ground                           ║
╚═══════════════╩═══════════════╩═════════════════════════════════════════╝

⚠️  YELLOW WIRES (Button):
   • YELLOW_1 has a diode (50% chance of correct polarity)
   • YELLOW_2 connects to GND (also has diode)
   • If button doesn't work: swap YELLOW_1 and YELLOW_2 positions
   • Correct connection: One yellow to GPIO20, other to GND

💡 LED IDENTIFICATION:
   • RED wire: Sword LED (weapon lighting effect)
   • PURPLE wire: Armor LED (body/chest lighting effect)
   • Both LEDs share common ground (GREEN or BLACK wires)


╔═══════════════════════════════════════════════════════════════════════════╗
║                       IMPORTANT NOTES                                     ║
╚═══════════════════════════════════════════════════════════════════════════╝

⚠️  POWER:
   • DFPlayer Mini operates at 5V (NOT 3.3V!)
   • Can draw up to 500mA when playing audio
   • Use external 5V adapter if USB power is insufficient
   • All GNDs must be common

⚠️  DFPLAYER:
   • DFPlayer has 6 pins but uses 4+2:
     - VCC, GND, RX, TX (4 pins - ESP connection)
     - SPK1, SPK2 (2 pins - speaker)
   • RX/TX pins are CROSSED:
     ESP32 TX (GPIO22) → DFPlayer RX
     ESP32 RX (GPIO23) → DFPlayer TX
   • SD card must be FAT32 formatted
   • MP3 files: 001.mp3, 002.mp3, 003.mp3...
   • Maximum 255 files supported

⚠️  LEDs:
   • Use 220Ω resistor for each LED
   • LED connection: GPIO → Resistor → LED (+) → GND
   • Wrong polarity will damage LED (long leg is +)

⚠️  BUTTON:
   • Use normally open (NO) button
   • Internal pull-up active, no external resistor needed
   • Not pressed = HIGH, Pressed = LOW

⚠️  SPEAKER:
   • 3W 4-8Ω speaker recommended
   • SPK1 and SPK2 polarity doesn't matter
   • DO NOT use headphones (may be damaged)

⚠️  PROGRAMMING:
   • Connect with USB-C cable
   • Arduino IDE board: XIAO_ESP32C6
   • Baud rate: 115200
   • USB CDC On Boot: Enabled


╔═══════════════════════════════════════════════════════════════════════════╗
║                     QUICK TEST PROCEDURE                                  ║
╚═══════════════════════════════════════════════════════════════════════════╝

1. Make all connections
2. Add 001.mp3 file to SD card
3. Connect to computer via USB
4. Upload code
5. Open Serial Monitor (115200 baud)
6. Send "test" command
7. See LEDs light up sequentially
8. Hear 001.mp3 playing

If no audio:
   → Serial shows "DFPlayer failed": Check connections
   → Audio too quiet: Send "volume 30" command
   → No audio at all: Check speaker connections


═══════════════════════════════════════════════════════════════════════════
                     Happy Making! 🎵
═══════════════════════════════════════════════════════════════════════════
